<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <link rel="stylesheet" href="bootstrap.min.css" />
    <link
      href="https://fonts.googleapis.com/css?family=Nunito:400,500,700,800,900"
      rel="stylesheet"
    />
    <title>List - Kanban</title>
  </head>
  <body>
    <div id="loadingScreen">
      <div class="loader"></div>
    </div>

    <!-- Modal -->
    <div
      class="modal fade"
      id="modalLabels"
      tabindex="-1"
      role="dialog"
      aria-labelledby="modalEditLabels"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalEditLabels">Edit labels</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <!-- MODAL CONTENT -->
            <form id="cards-columns-controller">
              <!-- LABEL 1 -->
              <div class="form-group">
                <label for="col1"
                  ><span class="labelTitle">LABEL</span> 1</label
                >
                <input
                  type="text"
                  class="form-control no-ml"
                  id="col1"
                  value=""
                />
              </div>

              <!-- LABEL 2 -->
              <div class="form-group">
                <label for="col2"
                  ><span class="labelTitle">LABEL</span> 2</label
                >
                <input
                  type="text"
                  class="form-control no-ml"
                  id="col2"
                  value=""
                />
              </div>

              <!-- LABEL 3 -->
              <div class="form-group">
                <label for="col3"
                  ><span class="labelTitle">LABEL</span> 3</label
                >
                <input
                  type="text"
                  class="form-control no-ml"
                  id="col3"
                  value=""
                />
              </div>

              <!-- LABEL 4 -->
              <div class="form-group">
                <label for="col4"
                  ><span class="labelTitle">LABEL</span> 4</label
                >
                <input
                  type="text"
                  class="form-control no-ml"
                  id="col4"
                  value=""
                />
              </div>

              <!-- LABEL 5 -->
              <div class="form-group">
                <label for="col5"
                  ><span class="labelTitle">LABEL</span> 5</label
                >
                <input
                  type="text"
                  class="form-control no-ml"
                  id="col5"
                  value=""
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
              id="closeModalLabels"
            >
              Close
            </button>
            <button type="button" class="btn btn-primary" id="saveLabels">
              Save changes
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- TOPBAR -->
    <div class="controls p-3">
      <form class="form-inline">
        <button
          type="button"
          id="backToHome"
          class="btn btn-primary mr-4 btn-home"
        >
          <span class="material-icons">arrow_back</span>
          <span>List</span>
        </button>

        <label for="titleInput">Title:</label>
        <input
          class="form-control form-control-sm"
          type="text"
          name="title"
          id="titleInput"
          autocomplete="off"
        />
        <label for="descriptionInput">Description:</label>
        <input
          class="form-control form-control-sm"
          type="text"
          name="description"
          id="descriptionInput"
          autocomplete="off"
        />
        <button class="btn btn-dark" id="add">Add</button>
        <button class="btn btn-danger mx-2" id="deleteAll">Delete All</button>

        <!-- Button trigger modal -->
        <button
          type="button"
          class="btn btn-primary"
          data-toggle="modal"
          data-target="#modalLabels"
          id="buttonOpenModalLabels"
        >
          Labels
        </button>

        <button class="btn" id="theme-btn">Dark/Light</button>
      </form>
    </div>
    <div class="boards overflow-auto p-0" id="boardsContainer"></div>

    <script>
      if (typeof module === 'object') {
        window.module = module;
        module = undefined;
      }
    </script>
    <script src="script.js" defer></script>
    <script src="jquery-3.5.1.min.js"></script>
    <script src="material-components-web.min.js"></script>
    <script src="popper.min.js"></script>
    <script src="bootstrap.min.js"></script>
    <script>
      if (window.module) module = window.module;
    </script>

    <!-- GOOGLE ANALYTICS -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-36251023-1']);
      _gaq.push(['_setDomainName', 'jqueryscript.net']);
      _gaq.push(['_trackPageview']);

      (function () {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src =
          ('https:' == document.location.protocol
            ? 'https://ssl'
            : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <!-- TRANSLATION -->
    <script type="text/javascript">
      window.onload = () => {
        const applyTranslation = () => {
          const translationStorage = localStorage.getItem('kanban.translation');

          if (translationStorage === null) return false;

          const theLabels = [...document.querySelectorAll('span.labelTitle')];
          const lblTitle = document.querySelector('label[for=titleInput]');
          const lblDesc = document.querySelector('label[for=descriptionInput]');
          const lblEditLabels = document.querySelector('#modalEditLabels');
          const btnAdd = document.querySelector('#add');
          const btnDeleteAll = document.querySelector('#deleteAll');
          const btnLabels = document.querySelector('#buttonOpenModalLabels');
          const btnThemeToogle = document.querySelector('#theme-btn');
          const btnSave = document.querySelector('#saveLabels');
          const btnClose = document.querySelector('#closeModalLabels');

          const translation = JSON.parse(translationStorage);

          lblTitle.innerText = translation.title;
          lblDesc.innerText = translation.description;
          lblEditLabels.innerText = translation.editLabels;
          btnAdd.innerText = translation.addButton;
          btnDeleteAll.innerText = translation.deleteAllButton;
          btnLabels.innerText = translation.editLabels;
          btnThemeToogle.innerText = translation.darkLightButton;
          btnSave.innerText = translation.saveChangesButton;
          btnClose.innerText = translation.closeButton;

          theLabels.map((item) => (item.innerText = translation.label));
        };

        applyTranslation();

        const KANBAN_CARDS = 'kanban.cards';
        const cardsStorage = localStorage.getItem(KANBAN_CARDS);
        const saveButton = document.querySelector('#saveLabels');
        const backToHome = document.querySelector('#backToHome');
        let cardDataToLoad = null;

        const cardsContainer = [
          ...document.querySelectorAll('#boardsContainer div.board > h3'),
        ];

        const inputElements = [
          ...document.querySelectorAll(
            '#cards-columns-controller input[type="text"]',
          ),
        ];

        // UI CHANGER
        const updateLabels = () => {
          console.log('Update UI using the values: ', cardDataToLoad);

          cardDataToLoad.map((item, index) => {
            inputElements[index].value = item;
            cardsContainer[index].innerText = item;
          });
        };

        if (cardsStorage !== null) {
          // RESTORE
          const parsedCards = JSON.parse(cardsStorage);
          cardDataToLoad = parsedCards;
        } else {
          // SET DEFAULT
          console.log('DEFAULT LABELS SET');
          const titles = ['BACKLOG', 'TO DO', 'IN PROGRESS', 'TESTING', 'DONE'];
          localStorage.setItem(KANBAN_CARDS, JSON.stringify(titles));
          cardDataToLoad = titles;
        }

        updateLabels();

        // EVENT LISTENER
        saveButton.addEventListener('click', () => {
          const newValues = inputElements.map((item) => item.value);
          localStorage.setItem(KANBAN_CARDS, JSON.stringify(newValues));
          cardDataToLoad = newValues;
          updateLabels();

          // close
          $('#modalLabels').modal('hide');
        });

        backToHome.addEventListener('click', () => {
          location.href = 'https://list.oneformes.com';
        });
      };
    </script>
  </body>
</html>
